<!doctype html>
<meta charset="utf-8">
<title>fun</title>
<body>
    <script src="pixi.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var boardState;
        var socket = io();
        //Aliases
        var Container = PIXI.Container,
            autoDetectRenderer = PIXI.autoDetectRenderer,
            loader = PIXI.loader,
            resources = PIXI.loader.resources,
            TextureCache = PIXI.utils.TextureCache,
            Sprite = PIXI.Sprite;
        //Create a Pixi stage and renderer and add the 
        //renderer.view to the DOM
        var stage = new Container(),
            renderer = autoDetectRenderer(900, 900);
        document.body.appendChild(renderer.view);
        
        var tiles = [];
        var peasants = [];
        //Use Pixi's built-in `loader` module to load an image
        loader
            .add("images/ground.png")
            .add("images/peasant.png")
            .load(setup);
        //This `setup` function will run when the image has loaded
        function setup() {
            
            
            
        }
        
        socket.on('board state', function(board){
            boardState = board;
            drawBoard();
            console.log('updating board');
        });
        
        function drawBoard(){
            for(var j = 0; j < 7; j++){
                for(var i = 0; i < 7; i++){
                    var tileNmb = i + j * 7;
                    if(boardState[tileNmb].terrain == 'grass'){
                        console.log('drawing grass');
                        tiles[tileNmb] = new Sprite(resources["images/ground.png"].texture);
                    }
                    tiles[tileNmb].x = i * tiles[0].width + ((j % 2) * tiles[0].width /2);
                    tiles[tileNmb].y = j * (tiles[0].height - (Math.sin(Math.PI/6) * (tiles[0].height / 2)));
                    stage.addChild(tiles[tileNmb]);       
                    
                    if(boardState[tileNmb].standing == 'peasant'){
                        console.log('drawing peasant');
                        peasants[tileNmb] = new Sprite(resources["images/peasant.png"].texture);
                        peasants[tileNmb].x = i * tiles[0].width + ((j % 2) * tiles[0].width /2) + tiles[0].width / 2 - peasants[0].width / 2;
                        peasants[tileNmb].y = j * (tiles[0].height - (Math.sin(Math.PI/6) * (tiles[0].height / 2))) + tiles[0].height / 2 - peasants[0].height / 2;;
                        stage.addChild(peasants[tileNmb]);
                    }
                }
            }
            renderer.render(stage);
        }
        
    </script>
</body>